<!DOCTYPE html>
<html lang="fi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Seuraa OLSin viikkopelejä, milloin pelit alkavat, ja millä kentällä.">
    <title>
        <%= documentTitle %>
    </title>
    <link rel="stylesheet" href="/css/style.min.css">
    <link rel="preload" href="https://fonts.gstatic.com/s/montserrat/v30/JTUHjIg1_i6t8kCHKm4532VJOt5-QNFgpCuM70w-.ttf" as="font" type="font/ttf" crossorigin="anonymous">
    <link rel="preload" href="https://fonts.gstatic.com/s/opensans/v43/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0C4n.ttf" as="font" type="font/ttf" crossorigin="anonymous">
    <link rel="preload" href="https://fonts.gstatic.com/s/opensans/v43/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsgH1y4n.ttf" as="font" type="font/ttf" crossorigin="anonymous">
    <style>
      /* Montserrat Regular */
      @font-face {
        font-family: 'Montserrat';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/montserrat/v30/JTUHjIg1_i6t8kCHKm4532VJOt5-QNFgpCuM70w-.ttf) format('truetype');
      }
      /* Open Sans Regular */
      @font-face {
        font-family: 'Open Sans';
        font-style: normal;
        font-weight: 400;
        font-stretch: normal;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/opensans/v43/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0C4n.ttf) format('truetype');
      }
      /* Open Sans Semi-Bold */
      @font-face {
        font-family: 'Open Sans';
        font-style: normal;
        font-weight: 600;
        font-stretch: normal;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/opensans/v43/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsgH1y4n.ttf) format('truetype');
      }
    </style>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Open+Sans:wght@400;600&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Open+Sans:wght@400;600&display=swap"></noscript>
    <style>
        body {
            font-family: 'Open Sans', sans-serif;
        }
        h1, h2, h3, h4, h5, h6, .font-heading {
            font-family: 'Montserrat', sans-serif;
        }
        .font-body {
            font-family: 'Open Sans', sans-serif;
        }
    </style>
</head>

<body class="bg-slate-100 text-slate-800 font-body flex flex-col min-h-screen">
    <div class="container mx-auto max-w-3xl flex-col flex-grow w-full">
        <header class="bg-green-700 text-white p-4 rounded-b-lg shadow-md font-heading">
            <h1 class="text-2xl md:text-3xl font-bold text-center">
                <%= documentTitle %>
            </h1>
        </header>

        <main class="p-4 md:p-8 mt-4 flex-grow">
        <form method="GET" id="teamSelectionForm" class="mb-6">
            <label for="team" class="block text-lg font-medium text-green-800 mb-2 font-heading">Valitse joukkue:</label>
            <select name="teamName" id="team" onchange="if (this.value) { window.location.href = '/team/' + encodeURIComponent(this.value); } else { window.location.href = '/'; }" class="w-full p-3 border border-slate-300 rounded-lg shadow-sm focus:ring-green-500 focus:border-green-500 font-body">
                <option value="">-- Kaikki joukkueet --</option>
                <% groupedTeams.forEach(group => { %>
                    <optgroup label="<%= group.year %>">
                        <% group.teams.forEach(team => { %>
                            <option value="<%= team %>" <%= selectedTeam === team ? 'selected' : '' %>>
                                <%= team %>
                            </option>
                        <% }); %>
                    </optgroup>
                <% }); %>
            </select>
        </form>

        <% if (selectedTeam && gamesForTeam.length > 0) { %>
            <h2 class="text-2xl font-semibold text-green-800 mb-4 text-center font-heading">
                <%= selectedTeam %> - Otteluohjelma
            </h2>

            <div class="space-y-6">
                <% gamesForTeam.forEach((game, index) => { %>
                    <% if (game.breakDurationMinutes && game.breakDurationMinutes > 0) { %>
                        <div class="bg-sky-50 border-l-4 border-sky-400 text-sky-700 p-4 rounded-md shadow-md my-4" role="alert">
                            <p class="font-bold font-heading">Tauko</p>
                            <p class="font-body"><%= game.breakDurationMinutes %> minuuttia</p>
                        </div>
                    <% } %>

                    <div class="bg-white p-5 rounded-lg shadow-xl border border-green-600 hover:shadow-2xl transition-shadow duration-300">
                        <div class="flex justify-between items-center mb-3">
                            <p class="text-xl font-bold text-green-700 font-heading">
                                <%= game.time %>
                            </p>
                            <p class="text-lg font-semibold text-slate-700 font-heading">
                                <%= game.field %>
                            </p>
                        </div>
                        <div class="mb-2">
                            <p class="text-md text-slate-800 font-body">
                                <span class="font-bold text-green-700"><%= selectedTeam.split('(')[0].trim() %></span> vs <span class="text-slate-700"><%= game.opponent.split('(')[0].trim() %></span>
                            </p>
                        </div>
                        <div class="text-xs text-slate-600 font-body mt-3 pt-3 border-t border-slate-200">
                            <span class="font-semibold">Pelimuoto:</span> <%= game.gameType %> &nbsp;&middot;&nbsp; 
                            <span class="font-semibold">Sarja/Ikäluokka:</span> <%= game.year %> &nbsp;&middot;&nbsp; 
                            <span class="font-semibold">Kesto:</span> <%= game.gameDuration %>
                        </div>

                        <% // Display field map for this game %>
                        <% 
                        let rawFieldKey = game.field.toUpperCase();
                        const normalizedFieldKey = rawFieldKey.replace(/\s+/g, ' ').trim().replace(/\s*-\s*/g, ' - ');
                        const originalPngImageName = fieldMapData[normalizedFieldKey]; 
                        if (originalPngImageName) { 
                            const nameWithoutExt = originalPngImageName.substring(0, originalPngImageName.lastIndexOf('.'));
                            const webpExtension = ".webp";
                        %>
                            <div class="mt-4 border border-slate-300 rounded-lg overflow-hidden shadow">
                                <picture>
                                    <source 
                                        srcset="<%= `${nameWithoutExt}-336w${webpExtension}` %> 336w,
                                                <%= `${nameWithoutExt}-504w${webpExtension}` %> 504w,
                                                <%= `${nameWithoutExt}-672w${webpExtension}` %> 672w"
                                        sizes="(max-width: 336px) 100vw, 336px" 
                                        type="image/webp">
                                    <img 
                                        src="<%= originalPngImageName %>" 
                                        alt="Kenttäkartta - <%= game.field %>" 
                                        class="block w-full h-auto"
                                        width="336" 
                                        height="508">
                                </picture>
                            </div>
                        <% } %>
                    </div>
                <% }); %>
            </div>
        <% } else if (selectedTeam) { %>
            <p class="text-center text-slate-500 mt-10 text-lg font-body">Ei pelejä valitulle joukkueelle.</p>
        <% } else { %>
            <p class="text-center text-slate-500 mt-10 text-lg font-body">Valitse joukkue ylläolevasta valikosta nähdäksesi otteluohjelman.</p>
        <% } %>
        </main>

        <footer class="bg-slate-800 text-slate-300 text-center p-4 rounded-t-lg mt-12 font-body shadow-inner">
            <p>Tämä on epävirallinen työkalu OLS Viikkopelien otteluohjelman selaamiseen.</p>
        </footer>
    </div>

    <script>
        // Optional: if you want to avoid the form action change and use JS for navigation
        // document.getElementById('team').addEventListener('change', function() {
        //     if (this.value) {
        //         window.location.href = '/team/' + encodeURIComponent(this.value);
        //     } else {
        //         window.location.href = '/';
        //     }
        // });
    </script>
</body>

</html>