<!DOCTYPE html>
<html lang="fi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Seuraa OLSin viikkopelejä, milloin pelit alkavat, ja millä kentällä.">
    <title>
        <%= documentTitle %>
    </title>
    
    <!-- Critical CSS inlined for fast initial render -->
    <style>
        /* Critical CSS - Complete styles for immediate render */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        *, ::before, ::after {
            --tw-border-spacing-x: 0; --tw-border-spacing-y: 0; --tw-translate-x: 0; --tw-translate-y: 0;
            --tw-rotate: 0; --tw-skew-x: 0; --tw-skew-y: 0; --tw-scale-x: 1; --tw-scale-y: 1;
            --tw-ring-inset: ; --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff;
            --tw-ring-color: rgb(59 130 246 / 0.5); --tw-ring-offset-shadow: 0 0 #0000;
            --tw-ring-shadow: 0 0 #0000; --tw-shadow: 0 0 #0000; --tw-shadow-colored: 0 0 #0000;
        }
        body { margin: 0; font-family: ui-sans-serif, system-ui, sans-serif; line-height: 1.5; }
        
        /* Layout classes */
        .min-h-screen { min-height: 100vh; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .flex-grow { flex-grow: 1; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .text-center { text-align: center; }
        .container { width: 100%; margin-left: auto; margin-right: auto; }
        .max-w-3xl { max-width: 48rem; }
        .w-full { width: 100%; }
        .h-8 { height: 2rem; }
        .w-8 { width: 2rem; }
        .block { display: block; }
        .inline-block { display: inline-block; }
        
        /* Spacing */
        .p-3 { padding: 0.75rem; }
        .p-4 { padding: 1rem; }
        .p-5 { padding: 1.25rem; }
        .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
        .mt-4 { margin-top: 1rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mt-2 { margin-top: 0.5rem; }
        .my-4 { margin-top: 1rem; margin-bottom: 1rem; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        
        /* Colors - Background */
        .bg-white { --tw-bg-opacity: 1; background-color: rgb(255 255 255 / var(--tw-bg-opacity, 1)); }
        .bg-green-700 { --tw-bg-opacity: 1; background-color: rgb(21 128 61 / var(--tw-bg-opacity, 1)); }
        .bg-slate-100 { --tw-bg-opacity: 1; background-color: rgb(241 245 249 / var(--tw-bg-opacity, 1)); }
        .bg-sky-50 { --tw-bg-opacity: 1; background-color: rgb(240 249 255 / var(--tw-bg-opacity, 1)); }
        
        /* Colors - Text */
        .text-white { --tw-text-opacity: 1; color: rgb(255 255 255 / var(--tw-text-opacity, 1)); }
        .text-green-800 { --tw-text-opacity: 1; color: rgb(22 101 52 / var(--tw-text-opacity, 1)); }
        .text-slate-600 { --tw-text-opacity: 1; color: rgb(71 85 105 / var(--tw-text-opacity, 1)); }
        .text-slate-700 { --tw-text-opacity: 1; color: rgb(51 65 85 / var(--tw-text-opacity, 1)); }
        .text-slate-800 { --tw-text-opacity: 1; color: rgb(30 41 59 / var(--tw-text-opacity, 1)); }
        .text-green-700 { --tw-text-opacity: 1; color: rgb(21 128 61 / var(--tw-text-opacity, 1)); }
        .text-sky-700 { --tw-text-opacity: 1; color: rgb(3 105 161 / var(--tw-text-opacity, 1)); }
        
        /* Colors - Borders */
        .border { border-width: 1px; }
        .border-b-2 { border-bottom-width: 2px; }
        .border-l-4 { border-left-width: 4px; }
        .border-green-700 { --tw-border-opacity: 1; border-color: rgb(21 128 61 / var(--tw-border-opacity, 1)); }
        .border-slate-300 { --tw-border-opacity: 1; border-color: rgb(203 213 225 / var(--tw-border-opacity, 1)); }
        .border-green-600 { --tw-border-opacity: 1; border-color: rgb(22 163 74 / var(--tw-border-opacity, 1)); }
        .border-sky-400 { --tw-border-opacity: 1; border-color: rgb(56 189 248 / var(--tw-border-opacity, 1)); }
        
        /* Typography */
        .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
        .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
        .text-2xl { font-size: 1.5rem; line-height: 2rem; }
        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
        .font-bold { font-weight: 700; }
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-heading { font-family: 'Montserrat', ui-sans-serif, system-ui, sans-serif; }
        .font-body { font-family: 'Open Sans', ui-sans-serif, system-ui, sans-serif; }
        
        /* Borders and shapes */
        .rounded-full { border-radius: 9999px; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-md { border-radius: 0.375rem; }
        .rounded-b-lg { border-bottom-right-radius: 0.5rem; border-bottom-left-radius: 0.5rem; }
        
        /* Shadows */
        .shadow-sm { --tw-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); --tw-shadow-colored: 0 1px 2px 0 var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow); }
        .shadow-md { --tw-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); --tw-shadow-colored: 0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow); }
        .shadow-xl { --tw-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1); --tw-shadow-colored: 0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow); }
        
        /* Loading animation */
        .animate-spin { animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Form styles */
        select, input { font-family: inherit; font-size: 100%; font-weight: inherit; line-height: inherit; color: inherit; }
        .focus\:ring-green-500:focus { --tw-ring-opacity: 1; --tw-ring-color: rgb(34 197 94 / var(--tw-ring-opacity, 1)); }
        .focus\:border-green-500:focus { --tw-border-opacity: 1; border-color: rgb(34 197 94 / var(--tw-border-opacity, 1)); }
        
        /* Spacing utilities */
        .space-y-6 > :not([hidden]) ~ :not([hidden]) { --tw-space-y-reverse: 0; margin-top: calc(1.5rem * calc(1 - var(--tw-space-y-reverse))); margin-bottom: calc(1.5rem * var(--tw-space-y-reverse)); }
        
        /* Transitions */
        .transition-shadow { transition-property: box-shadow; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        .duration-300 { transition-duration: 300ms; }
        .hover\:shadow-2xl:hover { --tw-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25); --tw-shadow-colored: 0 25px 50px -12px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow); }
        
        /* Responsive */
        @media (min-width: 768px) {
            .md\\:p-8 { padding: 2rem; }
            .md\\:text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
        }
    </style>
    
    <!-- Only load external CSS for enhanced features (optional) -->
    <link rel="preload" href="/css/style.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'" media="print">
    <noscript><link rel="stylesheet" href="/css/style.min.css"></noscript>
    <link rel="preload" href="https://fonts.gstatic.com/s/montserrat/v30/JTUHjIg1_i6t8kCHKm4532VJOt5-QNFgpCuM70w-.ttf" as="font" type="font/ttf" crossorigin="anonymous">
    <link rel="preload" href="https://fonts.gstatic.com/s/opensans/v43/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0C4n.ttf" as="font" type="font/ttf" crossorigin="anonymous">
    <link rel="preload" href="https://fonts.gstatic.com/s/opensans/v43/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsgH1y4n.ttf" as="font" type="font/ttf" crossorigin="anonymous">
    <style>
      /* Montserrat Regular */
      @font-face {
        font-family: 'Montserrat';
        font-style: normal;
        font-weight: 700;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/montserrat/v30/JTUHjIg1_i6t8kCHKm4532VJOt5-QNFgpCuM70w-.ttf) format('truetype');
      }
      /* Open Sans Regular */
      @font-face {
        font-family: 'Open Sans';
        font-style: normal;
        font-weight: 400;
        font-stretch: normal;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/opensans/v43/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0C4n.ttf) format('truetype');
      }
      /* Open Sans Semi-Bold */
      @font-face {
        font-family: 'Open Sans';
        font-style: normal;
        font-weight: 600;
        font-stretch: normal;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/opensans/v43/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsgH1y4n.ttf) format('truetype');
      }
    </style>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Open+Sans:wght@400;600&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Open+Sans:wght@400;600&display=swap"></noscript>
    <style>
        body {
            font-family: 'Open Sans', sans-serif;
        }
        h1, h2, h3, h4, h5, h6, .font-heading {
            font-family: 'Montserrat', sans-serif;
        }
        .font-body {
            font-family: 'Open Sans', sans-serif;
        }
    </style>
</head>

<body class="bg-slate-100 text-slate-800 font-body flex flex-col min-h-screen">
    <div class="container mx-auto max-w-3xl flex-col flex-grow w-full">
        <header class="bg-green-700 text-white p-4 rounded-b-lg shadow-md font-heading">
            <h1 class="text-2xl md:text-3xl font-bold text-center">
                <%= documentTitle %>
            </h1>
        </header>

        <main class="p-4 md:p-8 mt-4 flex-grow">
        <form method="GET" id="teamSelectionForm" class="mb-6">
            <label for="team" class="block text-lg font-medium text-green-800 mb-2 font-heading">Valitse joukkue:</label>
            <select name="teamName" id="team" onchange="if (this.value) { window.location.href = '/team/' + encodeURIComponent(this.value); } else { window.location.href = '/'; }" class="w-full p-3 border border-slate-300 rounded-lg shadow-sm focus:ring-green-500 focus:border-green-500 font-body">
                <option value="">-- Kaikki joukkueet --</option>
                <% groupedTeams.forEach(group => { %>
                    <optgroup label="<%= group.year %>">
                        <% group.teams.forEach(team => { %>
                            <option value="<%= team %>" <%= selectedTeam === team ? 'selected' : '' %>>
                                <%= team %>
                            </option>
                        <% }); %>
                    </optgroup>
                <% }); %>
            </select>
        </form>

        <% if (typeof loading !== 'undefined' && loading) { %>
            <div class="text-center py-8">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-green-700"></div>
                <p class="mt-4 text-lg text-green-800">Ladataan ottelutietoja...</p>
                <p class="text-sm text-slate-600 mt-2">Palvelin käynnistyy, odota hetki.</p>
            </div>
            <script>
                // Auto-refresh after 3 seconds
                setTimeout(() => {
                    window.location.reload();
                }, 3000);
            </script>
        <% } else if (selectedTeam && gamesForTeam.length > 0) { %>
            <h2 class="text-2xl font-semibold text-green-800 mb-4 text-center font-heading">
                <%= selectedTeam %> - Otteluohjelma
            </h2>

            <div class="space-y-6">
                <% gamesForTeam.forEach((game, index) => { %>
                    <% if (game.breakDurationMinutes && game.breakDurationMinutes > 0) { %>
                        <div class="bg-sky-50 border-l-4 border-sky-400 text-sky-700 p-4 rounded-md shadow-md my-4" role="alert">
                            <p class="font-bold font-heading">Tauko</p>
                            <p class="font-body"><%= game.breakDurationMinutes %> minuuttia</p>
                        </div>
                    <% } %>

                    <div class="bg-white p-5 rounded-lg shadow-xl border border-green-600 hover:shadow-2xl transition-shadow duration-300">
                        <div class="flex justify-between items-center mb-3">
                            <p class="text-xl font-bold text-green-700 font-heading">
                                <%= game.time %>
                            </p>
                            <p class="text-lg font-semibold text-slate-700 font-heading">
                                <%= game.field %>
                            </p>
                        </div>
                        <div class="mb-2">
                            <p class="text-md text-slate-800 font-body">
                                <span class="font-bold text-green-700"><%= selectedTeam.split('(')[0].trim() %></span> vs <span class="text-slate-700"><%= game.opponent.split('(')[0].trim() %></span>
                            </p>
                        </div>
                        <div class="text-xs text-slate-600 font-body mt-3 pt-3 border-t border-slate-200">
                            <span class="font-semibold">Pelimuoto:</span> <%= game.gameType %> &nbsp;&middot;&nbsp; 
                            <span class="font-semibold">Sarja/Ikäluokka:</span> <%= game.year %> &nbsp;&middot;&nbsp; 
                            <span class="font-semibold">Kesto:</span> <%= game.gameDuration %>
                        </div>

                        <% // Display field map for this game %>
                        <% 
                        let rawFieldKey = game.field.toUpperCase();
                        const normalizedFieldKey = rawFieldKey.replace(/\s+/g, ' ').trim().replace(/\s*-\s*/g, ' - ');
                        const originalPngImageName = fieldMapData[normalizedFieldKey]; 
                        if (originalPngImageName) { 
                            const nameWithoutExt = originalPngImageName.substring(0, originalPngImageName.lastIndexOf('.'));
                            const webpExtension = ".webp";
                        %>
                            <div class="mt-4 border border-slate-300 rounded-lg overflow-hidden shadow">
                                <picture>
                                    <source 
                                        srcset="<%= `${nameWithoutExt}-336w${webpExtension}` %> 336w,
                                                <%= `${nameWithoutExt}-504w${webpExtension}` %> 504w,
                                                <%= `${nameWithoutExt}-672w${webpExtension}` %> 672w"
                                        sizes="(max-width: 336px) 100vw, 336px" 
                                        type="image/webp">
                                    <img 
                                        src="<%= originalPngImageName %>" 
                                        alt="Kenttäkartta - <%= game.field %>" 
                                        class="block w-full h-auto"
                                        width="336" 
                                        height="508">
                                </picture>
                            </div>
                        <% } %>
                    </div>
                <% }); %>
            </div>
        <% } else if (selectedTeam) { %>
            <p class="text-center text-slate-500 mt-10 text-lg font-body">Ei pelejä valitulle joukkueelle.</p>
        <% } else { %>
            <p class="text-center text-slate-500 mt-10 text-lg font-body">Valitse joukkue ylläolevasta valikosta nähdäksesi otteluohjelman.</p>
        <% } %>
        </main>

        <footer class="bg-slate-800 text-slate-300 text-center p-4 rounded-t-lg mt-12 font-body shadow-inner">
            <p>Tämä on epävirallinen työkalu OLS Viikkopelien otteluohjelman selaamiseen.</p>
        </footer>
    </div>

    <script>
        // Optional: if you want to avoid the form action change and use JS for navigation
        // document.getElementById('team').addEventListener('change', function() {
        //     if (this.value) {
        //         window.location.href = '/team/' + encodeURIComponent(this.value);
        //     } else {
        //         window.location.href = '/';
        //     }
        // });
    </script>
</body>

</html>