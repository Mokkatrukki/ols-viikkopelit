# LiteFS config for admin app (primary/writer)
# This directory is where your application will access the database.
fuse:
  dir: "/litefs"

# This directory is where LiteFS will store internal data.
# You must place this directory on a persistent volume.
data:
  dir: "/var/lib/litefs"

# Running as a supervisor - LiteFS will start our app
exec:
  - cmd: "node dist/admin_app.js"
    # if-candidate: true  # Only run on primary candidates

# LiteFS HTTP API for node communication
http:
  addr: ":20202"

# Built-in proxy for write redirection and consistency
proxy:
  addr: ":8080"
  target: "localhost:8081"
  db: "games.db"

# Lease configuration for primary election
lease:
  type: "consul"
  
  # This node CAN become primary (admin app writes data)
  candidate: true
  
  # Automatically become primary after connecting and syncing
  promote: true
  
  # The API URL that other nodes will use to connect to this node
  advertise-url: "http://${FLY_ALLOC_ID}.vm.${FLY_APP_NAME}.internal:20202"
  
  consul:
    # The URL of the Consul cluster (set by fly consul attach)
    url: "${FLY_CONSUL_URL}"
    
    # A unique key shared by all nodes in the LiteFS cluster
    # Use a fixed name so both apps use the same cluster
    key: "ols-viikkopelit-cluster/primary"
